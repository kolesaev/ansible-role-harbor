---

- name: Create TLS certs directory
  ansible.builtin.file:
    path: "{{ harbor_parent_dir }}/harbor/tls"
    state: directory
    recurse: yes
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"

- name: Create private key (RSA, 4096 bits)
  community.crypto.openssl_privatekey:
    path: "{{ harbor_parent_dir }}/harbor/tls/certificate.key"

- name: Create simple self-signed certificate
  community.crypto.x509_certificate:
    path: "{{ harbor_parent_dir }}/harbor/tls/certificate.pem"
    privatekey_path: "{{ harbor_parent_dir }}/harbor/tls/certificate.key"
    provider: selfsigned